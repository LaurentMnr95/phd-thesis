\section{Towards Adversarial Consistency}
\label{sec:consistency}
In this section, we focus our study on the problem of adversarial consistency. In a first part, taking inspiration from~\citet{long2013consistency,awasthi2021calibration}, we study the $\varepsilon$-realisable case, i.e. the case where the adversarial risk at level $\varepsilon$ equals zero. In a second part, we analyze the behaviour of a candidate class of losses.



\subsection{The Realisable Case}
The feasible setting is an important case where there are no possible adversaries for the Bayes optimal classifier. Formally, this means that the risk of adversity is $0$, as shown in the following definition.

\begin{definition}[$\varepsilon$-realisability]
Let $\PP$ be a Borel probability distribution on $\XX\times\YY$ and $\varepsilon\geq0$. We say that $\PP$ is \emph{$\varepsilon$-realisable} if $\risk_{\varepsilon,\PP}^\star = 0$.
\end{definition}


In the case of realisable probability distribution, calibrated (and consequently consistent) margin losses in the standard classification setting are also calibrated and consistent in the adversarial case. 
\begin{prop}
\label{prop:realizable} 
Let $\varepsilon>0$. Let $\PP$ be an $\varepsilon$-realisable distribution and $\phi$ be a calibrated margin loss in the standard setting. Then $\phi$ is adversarially consistent at level $\varepsilon$. 
\end{prop}
The intuition behind this result is that if a probability distribution is $\varepsilon$-realisable, the marginal distributions are sufficiently separated so that there are no possible adversarial attacks, each point in the $\epsilon$-neighbourhood of the support of the distribution can be classified independently of each other. To formally prove this result, we need a preliminary lemma.


\begin{lemma}
    \label{lemma:realisable}
    Let $\PP$ be an $\varepsilon$-realisable distribution and $\phi$ be a calibrated margin loss in the standard setting. Then $\risk^\star_{\phi_\varepsilon,\PP}=\inf_{\alpha\in\RR}\phi(\alpha)$.
    \end{lemma}
\begin{proof}
Let $a\in\RR$ be such that $\phi(a)-\inf_{\alpha\in\RR} \phi(\alpha) \leq \epsilon$. $\PP$ being $\varepsilon$-realisable, there exists a measurable function $f$ such that:
\begin{align*}
    \risk_{\varepsilon,\PP}(f) = \mathbb{E}_\PP\left[\sup_{x'\in B_\varepsilon(x)} \mathbf{1}_{y\text{sign}(f(x))\leq 0}\right] &=  \PP\left[\exists x'\in B_\varepsilon(x), \text{sign}(f(x'))\neq y\right]\\
    &\leq \epsilon':= \frac{\epsilon}{\max(1,\phi(-a))}.\\
\end{align*}

Denoting $p =\PP(y=1)$, $\PP_1 = \PP[\cdot|y=1]$ and $\PP_{-1} = \PP[\cdot|y=-1]$, we have:
\begin{align*}
        p\times\PP_1\left[\exists x'\in B_\varepsilon(x), f(x')<0\right]\leq \epsilon'\text{ and }
                (1-p)\times\PP_{-1}\left[\exists x'\in B_\varepsilon(x), f(x')\geq0\right]\leq \epsilon'.
\end{align*}
Let us now define $g$ as:
\begin{align*}
        g(x)= \left\{
    \begin{array}{ll}
    a\text{ if } f(x)\geq 0\\
    -a\text{ if } f(x)< 0\\
    \end{array}
    \right.
\end{align*}

We have:

\begin{align*}
\risk_{\phi_\varepsilon,\PP}(g) &= \EE_\PP\left[\sup_{x'\in B_\varepsilon(x)}\phi(yg(x))\right]\\
&=p\times\EE_{\PP_1}\left[\sup_{x'\in B_\varepsilon(x)}\phi(g(x))\right] +(1-p)\times\EE_{\PP_{-1}}\left[\sup_{x'\in B_\varepsilon(x)}\phi(-g(x))\right]
\end{align*}
We have:
\begin{align*}
    p\times\EE_{\PP_1}\left[\sup_{x'\in B_\varepsilon(x)}\phi(g(x))\right]&\leq p\times\EE_{\PP_1}\left[\sup_{x'\in B_\varepsilon(x)}\phi(g(x))\mathbf{1}_{f(x')<0}\right]+p\times\EE_{\PP_1}\left[\sup_{x'\in B_\varepsilon(x)}\phi(g(x))\mathbf{1}_{f(x')\geq 0}\right] \\
    &=\phi(-a)\times p\times \PP_1\left[\exists x'\in B_\varepsilon(x), f(x')<0\right] \\
    &+ \phi(a)\times p\times\left(1- \PP_1\left[\exists x'\in B_\varepsilon(x), f(x')<0\right]\right)\\
    &\leq\phi(-a) \epsilon'+p\times\phi(a)\\
    &\leq p\times\inf_{\alpha\in\RR}\phi(\alpha) + 2\epsilon
\end{align*}

Similarly we get that:
\begin{align*}
(1-p)\times\EE_{\PP_{-1}}\left[\sup_{x'\in B_\varepsilon(x)}\phi(-g(x))\right] \leq(1-p)\times\inf_{\alpha\in\RR}\phi(\alpha)+2\epsilon
\end{align*}

We get: $\risk_{\phi_\varepsilon,\PP}(g)\leq \inf_{\alpha\in\RR}\phi(\alpha)+4\epsilon$ and, hence $\risk^\star_{\phi_\varepsilon,\PP}=\inf_{\alpha\in\RR}\phi(\alpha)$.
\end{proof}



We are now set to prove the result of consistency in the realisable case.
\begin{proof}
Let $0<\epsilon<1$. Thanks to Theorem~\ref{thm:cal-standard}, $\phi$ is uniformly calibrated for standard classification, then, there exists $\delta>0$ such that for all $f\in\mathcal{F}(\XX)$ and for all $x$:
\begin{align*}
    \phi(yf(x))-\inf_{\alpha\in\RR}\phi(\alpha)\leq \delta \implies \mathbf{1}_{y\text{sign}f(x)\leq 0} = 0
\end{align*}

Let now $f\in\mathcal{F}(\XX)$ be such that  $\risk_{\phi_\varepsilon,\PP}(f)\leq \risk_{\phi_\varepsilon,\PP}^\star+\delta\epsilon$.Thanks to Lemma~\ref{lemma:realisable},  we have:
\begin{align*}
\risk_{\phi_\varepsilon,\PP}(f)- \risk_{\phi_\varepsilon,\PP}^\star = \EE_{\PP}\left[\sup_{x'\in B_\varepsilon(x)}\phi(yf(x))-\inf_{\alpha \in \RR} \phi(\alpha)\right]\leq\delta\epsilon
\end{align*}

Then by Markov inequality:
\begin{align*}
    \PP\left[\sup_{x'\in B_\varepsilon(x)}\phi(yf(x))-\inf \phi\geq\delta\right]\leq\frac{\EE_{\PP}\left[\sup_{x'\in B_\varepsilon(x)}\phi(yf(x))-\inf \phi\right]}{\delta}\leq \epsilon
\end{align*}

So we have $\PP\left[\forall x'\in B_\varepsilon(x),\phi(yf(x))-\inf \phi\leq\delta\right]\geq1-\epsilon$ and then $\PP\left[\forall x'\in B_\varepsilon(x),\mathbf{1}_{y\text{sign}f(x)\leq 0} = 0\right]\geq1-\epsilon$. Since $\PP$ is $\varepsilon$-realisable, we have $\risk_{\varepsilon,\PP}^\star=0$ and:
\begin{align*}
        \risk_{\varepsilon,\PP}(f)- \risk_{\varepsilon,\PP}^\star =  \risk_{\varepsilon,\PP}(f) =\PP\left[\exists x'\in B_\varepsilon(x), \text{sign}(f(x'))\neq y\right]\leq \epsilon
\end{align*}
which concludes the proof.
\end{proof}



\subsection{Towards the General Case}
\label{sec:consis-gen}
In this section, we seek to pave the way towards proving the consistency of shifted odd losses. We will observe that their behavior is actually very similar to that of the $0/1$ loss, which makes them good candidates to be consistent losses. To this end, we first add an extra hypothesis to the odd shifted losses in order to simplify our technical analysis.
% \textcolor{blue}{What might lack here is explaining crudely why we believe this property to be fundamental. Its not only t simplify the analysis, is it ? And if it is, then it is important to explain why the analysis was hard before.}


\begin{definition}[$0/1$-like margin losses]
\label{def:limits}
$\phi$ is a \emph{$0/1$-like margin loss} if there exists $\lambda\geq0$, $\tau\geq0$, and a continuous lower bounded strictly decreasing odd function \textcolor{black}{$\psi$} in a neighbourhood of $0$ such that for all $\alpha\in\RR$, $\psi(\alpha)\geq -\lambda$ and $\phi(\alpha) = \lambda+\psi(\alpha-\tau)$ and
\begin{align*}
\lim_{t\to-\infty}\phi(t)=1\text{ and }\lim_{t\to+\infty}\phi(t)=0
\end{align*}
\end{definition}

Note here that the losses here are not necessarily shifted, making this condition weaker. Consequently, we cannot hope that such losses are consistent neither calibrated, but they might help in paving a way towards consistency.  Note also that if $\phi$ is a odd or shifted odd loss, one can always find a rescaling of $\phi$ such that $\phi$ becomes a $0/1$-like margin loss. Note also that such a rescaling does neither change the notion of consistency and calibration for $\phi$ nor for its rescaled version.






Based on min-max arguments, we provide below some results better characterizing$0/1$-like margin loss functions in the adversarial setting. Let us first recall the notions of \emph{midpoint property} and \emph{adversarial distributions set} that will be useful from now on as well as an important existing result from~\citet{pydi2021many}. 

\begin{definition}
Let $(\mathcal{X},d)$ be a proper Polish metric space. We say that $\XX$ satisfy the \emph{midpoint property} if for all $x_1,x_2\in\XX$ there exist $x\in\XX$ such that $d(x,x_1) = d(x,x_2) =\frac{d(x_1,x_2)}{2}$.
\end{definition}
We recall also the set $\mathcal{A}_\varepsilon(\PP)$ of adversarial distributions introduced in Chapter~\ref{chap:game}.
\begin{definition}
Let $\PP$ be a Borel probability distribution and $\varepsilon>0$.
We define the set of \emph{adversarial distributions} $\mathcal{A}_\varepsilon(\PP)$ as: 
\begin{align*}
\mathcal{A}_{\varepsilon}&(\PP) := \left\{\QQ\in\mathcal{M}^+_1(\mathcal{X}\times\mathcal{Y})\mid\exists \gamma\in\mathcal{M}^+_1\left((\mathcal{X}\times\mathcal{Y})^2\right),\right.\\
&\left.d(x,x')\leq\varepsilon,~y=y'~~ \gamma\text{-a.s.},~\Pi_{1\sharp}\gamma=\PP,~\Pi_{2\sharp}\gamma=\QQ\right\} 
\end{align*}

\end{definition}


\begin{thm}[\citet{pydi2021many}]
Let $\XX$ be a Polish space satisfying the midpoint property. Then strong duality holds:
\begin{align*}
\risk^\star_\varepsilon(\PP) = \inf_{f\in\mathcal{F}(\XX)}\sup_{\QQ\in\mathcal{A}_\varepsilon(\PP)} \risk_{\QQ}(f) =    \sup_{\QQ\in\mathcal{A}_\varepsilon(\PP)} \inf_{f\in\mathcal{F}(\XX)} \risk_{\QQ}(f)
\end{align*}
Moreover the supremum of the right-end term is attained. 
\end{thm}
Note that in the original version of the theorem, \citet{pydi2021many} did not prove that the supremum is attained. We add the proof for this property in Appendix xxx. 
% We are now ready to study the link between the adversarial risk associated with a $0/1$-like shifted odd loss and the $0/1$ loss.


\paragraph{Connections between $0/1$-like margin loss and $0/1$ loss: a min-max viewpoint.} Thanks the the above concepts, we can now present some results identifying the similarity and the differences between the  $0/1$ loss and a $0/1$-like margin losses. We first, show that for a given fixed probability distribution $\PP$, the adversarial optimal risk associated with a $0/1$-like margin loss and the $0/1$ loss are equal.

\begin{thm}
\label{thm:equalityrisk}
Let $\XX$ be a Polish space satisfying the midpoint property. Let $\varepsilon\geq 0$. Let $\PP$ be a Borel probability distribution over $\XX\times\YY$. Let ${\phi}$ be a $0/1$-like margin loss. Then, we have:
\begin{align*}
\risk^\star_{{\phi}_\varepsilon,\PP} = \risk^\star_{\varepsilon,\PP}
\end{align*}
\end{thm}

In particular, we note that this property holds true for the standard risk. To prove this result, we need the following lemma.


\begin{lemma}
    \label{lem:equalityriskstandard}
    Let $\QQ$ be a Borel probability distribution over $\XX\times\YY$. Let ${\phi}$ be a $0/1$-like shifted odd loss, then: $\risk_{\phi,\QQ}^\star =\risk_{\QQ}^\star$.
    \end{lemma}
    
    \begin{proof}
    \citet{bartlett2006convexity,steinwart2007compare} proved that: for every margin losses $\phi$,
    \begin{align*}
        \risk_{\phi,\QQ}^\star = \inf_{f\in\mathcal{F}(X)}\mathbb{E}_{(x,y)\sim\QQ}\left[\phi(yf(x))\right] &= \mathbb{E}_{x\sim\QQ_x}\left[\inf_{\alpha\in\RR}\QQ(y=1|x)\phi(\alpha)+(1-\QQ(y=-1|x))\phi(-\alpha)\right]\\
        &= \mathbb{E}_{x\sim\QQ_x}\left[\mathcal{C}_\phi^\star(\QQ(y=1|x),x)\right]\\
    \end{align*}
    We also have $ \risk_{\QQ}^\star =\mathbb{E}_{x\sim\QQ_x}\left[\mathcal{C}^\star(\QQ(y=1|x),x)\right] $. Moreover, if $\phi$ is a $0/1$-like shifted odd loss, then: for every $x\in\XX$ and $\eta\in[0,1]$, $\mathcal{C}_\phi^\star(\eta,x) =\min(\eta,1-\eta)=\mathcal{C}^\star(\eta,x)$. We can then conclude that  $\risk_{\phi,\QQ}^\star =\risk_{\QQ}^\star$.
    \end{proof}
    
    We are now set to prove Theorem~\ref{thm:equalityrisk}.
    
    \begin{proof}
    Let $\epsilon>0$ and $\PP$ be a distribution. Let $f$ such that $\risk_{\varepsilon,\PP}(f) \leq \risk_{\varepsilon,\PP}^\star +\epsilon$. Let $a>0$ such that $\phi(a)\geq 1-\epsilon$ and $\phi(-a)\leq\epsilon$. We define $g$ as: 
    \begin{align*}
         g(x)= \left\{
        \begin{array}{ll}
        a&\text{ if } f(x)\geq 0\\
        -a&\text{ if } f(x)< 0\\
      \end{array}
      \right.
    \end{align*}
    We have $\phi(yg(x)) = \phi(a) \mathbf{1}_{y sign(f(x))\leq 0}+  \phi(-a) \mathbf{1}_{y sign(f(x))>0}$. Then
    
    \begin{align*}
      \risk_{\phi_\varepsilon,\PP}(g) & = \EE_\PP\left[\sup_{x'\in B_\varepsilon(x)}\phi(yg(x))\right]\\
      & = \EE_\PP\left[\sup_{x'\in B_\varepsilon(x)}\phi(a) \mathbf{1}_{y sign(f(x'))\leq 0}+  \phi(-a) \mathbf{1}_{y sign(f(x'))>0}\right]\\
      &\leq  \EE_\PP\left[\sup_{x'\in B_\varepsilon(x)}\mathbf{1}_{y sign(f(x'))\leq 0}\right]+\phi(-a)\\
      &\leq \risk_{\varepsilon,\PP}^\star + 2\epsilon\quad.
    \end{align*}
    
    Then we have $\risk_{\phi_\varepsilon,\PP}^\star\leq \risk_{\varepsilon,\PP}^\star$.
    On the other side, we have: 
    
    \begin{align*}
     \risk_{\phi_\varepsilon,\PP}^\star & \geq \sup_{\QQ\in\mathcal{A}_\varepsilon(\PP)}  \inf_{f\in\mathcal{F}(\XX)} \risk_{\phi,\QQ}(f) = \sup_{\QQ\in\mathcal{A}_\varepsilon(\PP)}  \risk_{\phi,\QQ}^\star\\
      \\ &= \sup_{\QQ\in\mathcal{A}_\varepsilon(\PP)}  \risk_{\QQ}^\star= \sup_{\QQ\in\mathcal{A}_\varepsilon(\PP)}\inf_{f\in\mathcal{F}(\XX)} \risk_{\QQ}(f)  \\
      & =  \inf_{f\in\mathcal{F}(\XX)} \sup_{\QQ\in\mathcal{A}_\varepsilon(\PP)}\risk_{\QQ}(f) = \risk_{\varepsilon,\PP}^\star \\
    \end{align*}
Then finally we get that $\risk_{\phi_\varepsilon,\PP}^\star=  \risk_{\varepsilon,\PP}^\star$.
    
    \end{proof}



From this result, we can derive two interesting corollaries about  $0/1$-like margin losses. First, strong duality holds for the risk associated with ${\phi}$.

\begin{coro}[Strong duality for $\phi$] 
\label{coro:nash}
Let assume that $\XX$ be a Polish space satisfying the midpoint property. Let $\varepsilon\geq 0$. Let $\PP$ be a Borel probability distribution over $\XX\times\YY$. Let ${\phi}$ be a $0/1$-like margin loss. Then, we have:
\begin{align*}
\inf_{f\in\mathcal{F}(\XX)}\sup_{\QQ\in\mathcal{A}_\varepsilon(\PP)} \risk_{\phi,\QQ}(f) =    \sup_{\QQ\in\mathcal{A}_\varepsilon(\PP)} \inf_{f\in\mathcal{F}(\XX)} \risk_{\phi,\QQ}(f)
\end{align*}
Moreover the supremum is attained.
\end{coro}

Note that there is no reason that the infimum is attained. A second interesting corollary is the equality of the set of optimal attacks, i.e. distributions of $\mathcal{A}_\varepsilon(\PP)$ that realizes maximizes the dual problem, for the same for the $0/1$ loss and $0/1$-like margin loss.


\begin{coro}[Optimal attacks]
\label{coro:optattacks}
Let assume that $\XX$ be a Polish space satisfying the midpoint property. Let $\varepsilon\geq 0$. Let $\PP$ be a Borel probability distribution over $\XX\times\YY$. Then, an optimal attack $\QQ^\star$  of level $\varepsilon$  exists for both the $0/1$ loss and  $\phi$. Moreover, for $\QQ\in\mathcal{A}_\varepsilon(\PP)$.  $\QQ$ is an optimal attack for the loss $\phi$  if and only if it is an optimal attack for the $0/1$ loss.
\end{coro}


\paragraph{A step towards consistency.} From the previous results, we are able to prove a first result toward teh demonstration of consistency. This result is much weaker than consistency result, but it guarrantees \textcolor{blue}{[...]}
\begin{prop}
\label{prop:pseudo}
Let assume that $\XX$ be a Polish space satisfying the midpoint property. Let $\varepsilon\geq 0$. Let $\PP$ be a Borel probability distribution over $\XX\times\YY$.  Let $\QQ^\star$ be an optimal attack of level $\varepsilon$. Let $(f_n)_n$ be a sequence of $\mathcal{F}(\XX)$ such that $\risk_{\phi_\varepsilon,\PP}(f_n)\to\risk_{\phi_\varepsilon,\PP}^\star$. Then $\risk_{\QQ^\star}(f_n)\to\risk_{\varepsilon,\PP}^\star$.
\end{prop}


We hope this result and its proof may lead to a full proof of consistency. This result is significantly weaker than consistency as stated in the following remark. In the proof of the previous results, we did not use the assumptions that losses are shifted. In our opinion, it is the key element that we miss and need to use to conclude the consistency of this family of losses. The shift in the loss would force the classifier to goes to $\pm \infty$ on the $\varepsilon$ neighbourhood support of the distribution of $\PP$. This question is complicated and is left as further work.  
